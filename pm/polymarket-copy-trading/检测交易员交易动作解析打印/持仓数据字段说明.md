# Polymarket 持仓数据字段说明

## 概述
本文档详细说明 Polymarket 持仓数据中各个字段的含义和计算方式，帮助理解持仓状态和盈亏情况。

## 基本持仓信息

### 市场信息
- **token_id**: 代币唯一标识符
- **condition_id**: 市场条件ID，用于关联特定的预测市场
- **title**: 市场标题
- **outcome**: 预测结果（如 "Yes"/"No" 或具体选项）
- **end_date**: 市场到期时间
- **redeemable**: 是否可赎回（市场结束后）
- **negative_risk**: 是否为负风险市场

### 持仓数量信息
- **size**: 当前持仓股数
- **total_bought**: 总买入股数（历史累计）
- **avg_price**: 平均买入价格
- **cur_price**: 当前市场价格

## 示例数据分析

基于你选中的数据：
```json
"size": 800.0,
"total_bought": 800.0,
"avg_price": 0.99,
"cur_price": 0.9995,
"initial_value": 792.0,
"current_value": 799.6,
"cash_pnl": 7.6,
"percent_pnl": 0.9595959595959596
```

### 计算过程分析

1. **持仓状态分析**：
   - `size` (800.0) == `total_bought` (800.0) = 说明这是买入后未卖出的完整持仓

2. **成本计算**：
   - `avg_price` × `size` = 0.99 × 800 = 792.0 USDC
   - 这与 `initial_value` (792.0) 完全匹配 ✓

3. **当前价值计算**：
   - `cur_price` × `size` = 0.9995 × 800 = 799.6 USDC
   - 这与 `current_value` (799.6) 完全匹配 ✓

4. **盈亏计算**：
   - **现金盈亏**: `current_value` - `initial_value` = 799.6 - 792.0 = 7.6 USDC
   - **百分比盈亏**: (`current_value` - `initial_value`) / `initial_value` × 100 = (7.6 / 792.0) × 100 = 0.9596%

## 字段详细说明

### 核心财务字段

| 字段名 | 数据类型 | 说明 | 计算方式 |
|--------|----------|------|----------|
| **size** | float | 当前持仓股数 | 动态变化，随买卖而增减 |
| **total_bought** | float | 历史总买入股数 | 累计值，只增不减 |
| **avg_price** | float | 平均买入成本 | 总买入成本 / 总买入股数 |
| **cur_price** | float | 当前市场价格 | 实时市场最新价格 |

### 价值与盈亏字段

| 字段名 | 数据类型 | 说明 | 计算方式 |
|--------|----------|------|----------|
| **initial_value** | float | 初始投资价值 | `avg_price` × `size` |
| **current_value** | float | 当前持仓价值 | `cur_price` × `size` |
| **cash_pnl** | float | 现金盈亏（绝对值） | `current_value` - `initial_value` |
| **percent_pnl** | float | 百分比盈亏（相对值） | (`current_value` - `initial_value`) / `initial_value` × 100 |

### 市场状态字段

| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| **end_date** | string | 市场到期时间 |
| **redeemable** | boolean | 市场结束后是否可领取收益 |
| **negative_risk** | boolean | 是否为负风险市场（保本型） |

## 实际应用场景

### 1. 盈亏分析
- **正盈亏** (`cash_pnl` > 0): 投资盈利
- **负盈亏** (`cash_pnl` < 0): 投资亏损
- **零盈亏** (`cash_pnl` = 0): 保本状态

### 2. 持仓状态判断
- **完整持仓**: `size` == `total_bought` (未卖出)
- **部分卖出**: `size` < `total_bought` (已卖出部分)
- **完全清仓**: `size` == 0 (已全部卖出)

### 3. 价格变动影响
- **价格上涨**: `cur_price` > `avg_price` → 盈利
- **价格下跌**: `cur_price` < `avg_price` → 亏损
- **价格持平**: `cur_price` ≈ `avg_price` → 保本

## 数据文件说明

### 交易员持仓缓存文件
- **路径**: `data/trader_positions_cache.json`
- **结构**:
```json
{
  "交易员地址1": [
    {
      "trader_address": "交易员钱包地址",
      "token_id": "代币ID",
      "condition_id": "市场条件ID",
      "title": "市场标题",
      "outcome": "预测结果",
      "size": 800.0,
      "total_bought": 800.0,
      "avg_price": 0.99,
      "cur_price": 0.9995,
      "initial_value": 792.0,
      "current_value": 799.6,
      "cash_pnl": 7.6,
      "percent_pnl": 0.9595959595959596,
      "end_date": "2025-12-31T23:59:59Z",
      "redeemable": false,
      "negative_risk": false,
      "timestamp": "2025-12-10T18:15:00.000Z"
    }
  ]
}
```

### 我的持仓缓存文件
- **路径**: `data/position_cache.json`
- **结构**:
```json
{
  "wallet_address": "我的钱包地址",
  "positions": [持仓数据数组],
  "timestamp": "数据更新时间",
  "total_positions": 持仓总数
}
```

## 使用建议

1. **监控盈亏**: 定期查看 `cash_pnl` 和 `percent_pnl` 了解投资表现
2. **风险控制**: 关注 `negative_risk` 字段了解风险类型
3. **时机把握**: 结合 `cur_price` 和 `avg_price` 决定买卖时机
4. **到期管理**: 注意 `end_date` 和 `redeemable` 状态，及时处理到期持仓

## 常见计算公式

### 持仓收益率
```
收益率 = (当前价格 - 平均成本) / 平均成本 × 100%
```

### 总盈亏
```
总盈亏 = (当前价格 - 平均成本) × 持仓数量
```

### 平均成本更新
```
新平均成本 = (原持仓成本 + 新买入成本) / (原持仓数量 + 新买入数量)
```